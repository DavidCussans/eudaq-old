#!/bin/bash

if [ "$2" == "" ]; then
  echo "Usage: svnswitch <newrepo> <svn-command> [svn-params]..."
  echo "  e.g. svnswitch svn+ssh://corrin@login.hepforge.org/hepforge/svn/eudaq ci -m \"blah\""
  exit 1
fi

OLDREPO=`svn info | grep '^Repository Root: ' | sed 's/^[^:]*: //'`
NEWREPO=$1

shift

echo "Switching from $OLDREPO to $NEWREPO"
if ! svn switch --relocate "$OLDREPO" "$NEWREPO"; then
  echo "Error: Unable to switch repository"
  exit 1
fi
echo "Performing command: $@"
svn "$@"
echo "Returning repository back to original setting"
svn switch --relocate "$NEWREPO" "$OLDREPO"
